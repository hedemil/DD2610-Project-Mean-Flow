# Training Config V2: NO VELOCITY MATCHING ABLATION
#
# Research Question: Is velocity matching necessary for MeanFlow's performance?
#
# ABLATION: Remove velocity matching entirely
# - V1 (baseline): 75% data matching (r=t), 25% velocity matching (r≠t)
# - V2 (this):     100% data matching (r=t), 0% velocity matching
#
# Background:
# MeanFlow's key innovation is combining two training objectives:
# 1. Data matching (r=t): Train to denoise from timestep t to t
# 2. Velocity matching (r≠t): Train to learn the velocity field between timesteps
#
# The paper uses 75/25 split. This tests pure data matching (100/0).
#
# Hypothesis:
# Velocity matching helps the model learn better flow structure.
# Removing it should hurt performance, validating MeanFlow's core innovation.
#
# Expected Results:
# - Worse IoU than V1 (validates velocity matching is important)
# - Possibly higher v_loss or training instability
# - Demonstrates that MeanFlow's mixed objective is beneficial

model:
    cls: DiT_S_4
    input_size: 16
    in_channels: 16

dataset:
    name: mnist3d_latent
    root: data/mnist3d_latents
    image_size: 16
    image_channels: 16
    num_classes: 10

training:
    # Keep EXACTLY the same as V1
    batch_size: 64
    num_epochs: 500
    learning_rate: 0.0001
    adam_b2: 0.999
    ema_type: 'const'
    ema_val: 0.99995

    # Logging and checkpointing
    log_per_step: 10
    checkpoint_per_epoch: 25
    keep_checkpoints: 5

    # Sampling during training
    sample_on_training: true
    sample_per_epoch: 5

    # Evaluation
    eval_on_training: true
    eval_per_epoch: 25
    eval_batch_size: 100
    eval_num_real: 100

    seed: 42
    half_precision: false

sampling:
    num_steps: 1
    num_classes: 10
    seed: 42

evaluation:
    chamfer_threshold: -0.5
    chamfer_enabled: true
    iou_threshold: -0.5
    iou_enabled: true
    fid_views: ['xy', 'xz', 'yz']
    fid_enabled: false
    early_stopping_metric: 'chamfer_distance'
    early_stopping_patience: 50
    early_stopping_min_delta: 0.01

load_from: null
eval_only: False

# MeanFlow method parameters
method:
    # Time sampling - same as V1
    noise_dist: logit_normal
    P_mean: -0.4
    P_std: 1.0

    # ===== ABLATION: NO VELOCITY MATCHING =====
    data_proportion: 1.0  # CHANGED: 0.75 → 1.0 (100% data, 0% velocity)

    # All other parameters IDENTICAL to V1
    class_dropout_prob: 0.1
    guidance_eq: cfg
    kappa: 0.5
    norm_eps: 0.01
    norm_p: 1.0
    omega: 1.0  # SAME as V1 (not 3.0!)
    t_end: 1.0
    t_start: 0.0

# Discussion for Report:
#
# This ablation validates MeanFlow's core contribution:
# - If V2 performs worse than V1, velocity matching is crucial
# - If V2 performs similarly, the 75/25 split may not matter for 3D MNIST
# - Compare v_loss between V1 and V2 (V2 should have lower/zero v_loss)
